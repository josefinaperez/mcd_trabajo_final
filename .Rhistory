shp_path <- "data/shp/argentina/argentina.shp"
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path)
class(preproc)
knitr::opts_chunk$set(echo = TRUE)
source("r/src/preprocessing.R")
source("r/src/preprocessing.R")
source("r/src/preprocessing.R")
source("r/src/preprocessing.R")
source("r/src/utils.R")
source("r/src/preprocessing.R")
getwd()
source("../src/preprocessing.R")
source("../src/preprocessing.R")
View(df_clean)
View(df_clean)
source("../src/preprocessing.R")
source("../src/preprocessing.R")
df_path <- "data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "data/shp/argentina/argentina.shp"
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path)
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path)
preproc$df_flagged
df_flagged <- preproc$df_flagged
df_clean <- preproc$df_clean
df_flagged$.summary
flags
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
flags
flags$.summary
flags
class(flags)
flags$.summary
flag_cols <- names(flags)[grepl("^\\.", names(flags)) & names(flags) != ".summary"]
flag_cols
df_flagged$FLAG <- apply(
flags[!flags$.summary, flag_cols],
1,
function(x) {
paste(flag_cols[!x], collapse = ", ")
}
)
source("../src/preprocessing.R")
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path)
df_clean <- preproc$df_clean
df_flagged <- preproc$df_flagged
df_flagged
df_flagged$FLAG
df_flagged$FLAG <- apply(
flags[!flags$.summary, flag_cols],
1,
function(x) {
paste(flag_cols[!x], collapse = ", ")
}
)
dplyr::count(df_flagged, FLAG)
filter(df_flagged, FLAG == .sea)
filter(df_flagged, FLAG == ".cap")
filter(df_flagged, FLAG == ".cap")$decimalLatitude
shp <- create_shp_from(shp_sf_path)
shp <- create_shp_from(shp_path)
shp <- create_shp_from(shp_path)
ggplot() +
layer_shp(shp) +
layer_points(filter(df_flagged, FLAG == ".cap"),
crs = st_crs(shp),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
library(ggplot2)
shp <- create_shp_from(shp_path)
ggplot() +
layer_shp(shp) +
layer_points(filter(df_flagged, FLAG == ".cap"),
crs = st_crs(shp),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
source("../src/plot.R")
shp <- create_shp_from(shp_path)
ggplot() +
layer_shp(shp) +
layer_points(filter(df_flagged, FLAG == ".cap"),
crs = st_crs(shp),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
shp <- create_shp_from(shp_path)
ggplot() +
#layer_shp(shp) +
layer_points(filter(df_flagged, FLAG == ".cap"),
crs = st_crs(shp),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
dplyr::count(df_flagged, FLAG)
filter(df_flagged, FLAG == ".cap")
filter(df_flagged, FLAG == ".cen")
filter(df_flagged, FLAG == ".inst")
shp <- create_shp_from(shp_path)
ggplot() +
#layer_shp(shp) +
layer_points(filter(df_flagged, FLAG == ".sea"),
crs = st_crs(shp),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
shp <- create_shp_from(shp_path)
ggplot() +
layer_shp(shp) +
layer_points(filter(df_flagged, FLAG == ".sea"),
crs = st_crs(shp),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
filter(df_flagged, FLAG == ".sea")
library(ggplot2)
source("../src/preprocessing.R")
source("../src/plot.R")
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
tests <- c(#"capitals",
"centroids",
"equal",
"gbif",
#"institutions",
"outliers",
#"seas",
"zeros")
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path)
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path,
tests)
df_clean <- preproc$df_clean
df_flagged <- preproc$df_flagged
tests <- c(#"capitals",
#"centroids",
"equal",
"gbif",
#"institutions",
"outliers",
#"seas",
"zeros")
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path,
tests)
df_clean <- preproc$df_clean
df_flagged <- preproc$df_flagged
shp <- create_shp_from(shp_path)
ggplot() +
layer_shp(shp) +
layer_points(df_clean,
crs = st_crs(shp),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
knitr::opts_chunk$set(echo = TRUE)
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
tests <- c(#"capitals",
#"centroids",
"equal",
"gbif",
#"institutions",
"outliers",
#"seas",
"zeros")
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path,
tests)
df_clean <- preproc$df_clean
df_flagged <- preproc$df_flagged
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
tests <- c(#"capitals",
#"centroids",
"equal",
"gbif",
#"institutions",
"outliers",
#"seas",
"zeros")
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path,
tests)
df_clean <- preproc$df_clean
df_flagged <- preproc$df_flagged
library(ggplot2)
source("../src/preprocessing.R")
source("../src/plot.R")
plot_points_in_map(df_clean, shp_path)
plot_points_in_map(df_clean, shp_path)
df_trametes_sanguinea <- read_csv("../../data/ocurrences/raw/df_trametes_sanguinea.csv")
plot_points_in_map(df_trametes_sanguinea, "../../data/shp/argentina/argentina.shp")
?clean_coordinates
?clean_coordinates
library(CoordinateCleaner)
?clean_coordinates
knitr::opts_chunk$set(echo = TRUE)
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
tests <- c(#"capitals",
#"centroids",
"equal",
"duplicates",
"gbif",
#"institutions",
"outliers",
#"seas",
"zeros")
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path,
tests)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
source("../src/preprocessing.R")
source("../src/plot.R")
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
tests <- c(#"capitals",
#"centroids",
"equal",
"duplicates",
"gbif",
#"institutions",
"outliers",
#"seas",
"zeros")
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path,
tests)
df_clean <- preproc$df_clean
df_flagged <- preproc$df_flagged
plot_points_in_map(df_clean, shp_path)
df_flagged
df_flagged
df_flagged$decimalLatitude
df_flagge
df_flagged %>% select(decimalLatitude, decimalLongitude)
df_clean %>% filter(decimalLatitude == -34.58259)
df_clean %>% filter(decimalLatitude = -34.58259)
df_clean %>% filter(decimalLatitude == -34.58259)
df_clean %>% filter(decimalLongitude == -58.41729)
df_clean %>% filter(decimalLongitude == -58.44366)
df_flagged %>% filter(FLAG == .dup) %>% select(decimalLatitude, decimalLongitude)
df_flagged %>% filter(FLAG == ".dup") %>% select(decimalLatitude, decimalLongitude)
df_flagged$FLAG
df_flagged %>% filter(FLAG == ".dpl") %>% select(decimalLatitude, decimalLongitude)
df_clean %>% filter(decimalLongitude == -58.41729)
df_clean %>% filter(decimalLongitude == -58.44366)
df_clean %>%
filter(
abs(decimalLatitude  - -34.58259) < 1e-8 &
abs(decimalLongitude - -58.41729) < 1e-8
)
df_trametes_sanguinea <- read_csv("../../data/ocurrences/raw/df_trametes_sanguinea.csv")
plot_points_in_map(df_trametes_sanguinea, "../../data/shp/argentina/argentina.shp")
df_trametes_sanguinea %>%
filter(
abs(decimalLatitude  - -34.58259) < 1e-8 &
abs(decimalLongitude - -58.41729) < 1e-8
)
df_trametes_sanguinea %>% filter(decimalLongitude == -58.44366)
View(df_flagged)
df_trametes_sanguinea %>% filter(http://unknown.org/nick == noeliamedina89)
df_trametes_sanguinea %>% filter("http://unknown.org/nick" == noeliamedina89)
df_trametes_sanguinea %>% filter("http://unknown.org/nick" == "noeliamedina89")
df_trametes_sanguinea %>% filter(ocurrenceID == "https://www.inaturalist.org/observations/330093285
")
df_trametes_sanguinea %>% filter(ocurrenceID == "https://www.inaturalist.org/observations/330093285")
df_trametes_sanguinea$occurrenceID
df_trametes_sanguinea %>% filter("ocurrenceID" == "https://www.inaturalist.org/observations/330093285")
df_trametes_sanguinea
View(df_trametes_sanguinea)
df_trametes_sanguinea %>% filter(datasetKey == "50c9509d-22c7-4a22-a47d-8c48425ef4a7")
df_trametes_sanguinea %>% filter(ocurrenceID == "https://www.inaturalist.org/observations/330093285
")
df_trametes_sanguinea %>% filter(ocurrenceID == "https://www.inaturalist.org/observations/330093285")
df_trametes_sanguinea$occurrenceID
df_trametes_sanguinea %>% filter(occurrenceID == "https://www.inaturalist.org/observations/330093285")
df_trametes_sanguinea %>% filter(decimalLatitude == "-34.58259")
df_trametes_sanguinea %>% filter(decimalLatitude == -34.58259)
df_flagged %>% filter(FLAG == ".dpl") %>% select(occurrenceID, decimalLongitude)
df_trametes_sanguinea %>% filter(occurenceID == "https://www.inaturalist.org/observations/274125733") %>% select(decimalLatitude, decimalLongitude)
df_trametes_sanguinea %>% filter(occurrenceID == "https://www.inaturalist.org/observations/274125733") %>% select(decimalLatitude, decimalLongitude)
df_trametes_sanguinea %>% filter(occurrenceID == "https://www.inaturalist.org/observations/274125733") %>% View()
df_trametes_sanguinea %>% filter(decimalLongitude == -58.41729) %>% View()
df_trametes_sanguinea %>% filter(decimalLongitude == -58.4) %>% View()
options(digits = 15)
df_trametes_sanguinea %>%
filter(occurrenceID == "https://www.inaturalist.org/observations/274125733") %>%
select(decimalLatitude, decimalLongitude)
options(digits = 15)
df_trametes_sanguinea %>%
filter(occurrenceID == "https://www.inaturalist.org/observations/274125733") %>%
select(decimalLatitude, decimalLongitude)
df_trametes_sanguinea %>%
filter(occurrenceID == "https://www.inaturalist.org/observations/274125733") %>%
select(decimalLatitude, decimalLongitude)
row_target <- df_trametes_sanguinea %>%
filter(occurrenceID == "https://www.inaturalist.org/observations/274125733")
row_target
df_clean %>%
filter(
abs(decimalLatitude  - row_target$decimalLatitude) < 1e-10 &
abs(decimalLongitude - row_target$decimalLongitude) < 1e-10
)
df_clean %>%
filter(
abs(decimalLatitude  - row_target$decimalLatitude) < 1e-10 &
abs(decimalLongitude - row_target$decimalLongitude) < 1e-10
)
df_flagged %>% filter(FLAG == ".dpl")
row_target <- df_trametes_sanguinea %>%
filter(occurrenceID == "https://www.inaturalist.org/observations/286154291")
df_clean %>%
filter(
abs(decimalLatitude  - row_target$decimalLatitude) < 1e-10 &
abs(decimalLongitude - row_target$decimalLongitude) < 1e-10
)
row_target <- df_trametes_sanguinea %>%
filter(occurrenceID == "https://www.inaturalist.org/observations/293598029")
df_clean %>%
filter(
abs(decimalLatitude  - row_target$decimalLatitude) < 1e-10 &
abs(decimalLongitude - row_target$decimalLongitude) < 1e-10
)
?clean_coordinates
df_flagged %>% filter(FLAG == "inst")
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
tests <- c(#"capitals",
#"centroids",
"equal",
"duplicates",
"gbif",
"institutions",
"outliers",
#"seas",
"zeros")
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path,
tests)
df_clean <- preproc$df_clean
df_flagged <- preproc$df_flagged
plot_points_in_map(df_clean, shp_path)
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst") %>% plot_points_in_map(shp_path)
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_flagged %>% filter(FLAG == ".inst")
df_path <- "../../data/ocurrences/raw/df_trametes_sanguinea.csv"
preproc_path <- "../../data/ocurrences/processed/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
shp_path <- "../../data/shp/argentina/argentina.shp"
tests <- c(#"capitals",
#"centroids",
"equal",
"duplicates",
"gbif",
#"institutions",
"outliers",
#"seas",
"zeros",
"urban")
preproc <- preprocess_dataset(df_path,
preproc_path,
min_year,
scientific_name,
max_uncertainty_km,
shp_path,
tests)
df_clean <- preproc$df_clean
df_flagged <- preproc$df_flagged
plot_points_in_map(df_clean, shp_path)
df_flagged %>% filter(FLAG == ".urban") %>% plot_points_in_map(shp_path)
flags
df_flagged$FLAG
df_flagged %>% filter(FLAG == ".urb") %>% plot_points_in_map(shp_path)
