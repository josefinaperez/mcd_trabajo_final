install.packages("CoordinateCleaner")
library(CoordinateCleaner)
install.packages("rgbif")
install.packages("xml2")
install.packages("CoordinateCleaner")
library(CoordinateCleaner)
minages <- runif(250, 0, 65)
exmpl <- data.frame(species = sample(letters, size = 250, replace = TRUE),
decimalLongitude = runif(250, min = 42, max = 51),
decimalLatitude = runif(250, min = -26, max = -11),
min_ma = minages,
max_ma = minages + runif(250, 0.1, 65),
dataset = "clean")
exmlp
exmpl
library(readr)
df_trametes_sanguinea <- read_csv("data/ocurrences/raw/df_trametes_sanguinea.csv")
View(df_trametes_sanguinea)
nrow(df_
trametes)
nrow(df_
trametes_sanguinea)
nrow(df_trametes_sanguinea)
dat <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
install.packages(dplyr)
install.packages("dplyr")
dat <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
library(dplyr)
dat <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
dat
nrow(dat)
dat$countryCode <-  countrycode(dat$countryCode,
origin =  'iso2c',
destination = 'iso3c')
View(dat)
dat <- data.frame(dat)
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
countries = "countryCode",
species = "species",
tests = c("capitals", "centroids",
"equal", "zeros", "countries"))
install.packages("rnaturalearthdata")
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
countries = "countryCode",
species = "species",
tests = c("capitals", "centroids",
"equal", "zeros", "countries"))
flags
summary(flags)
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
#countries = "countryCode",
species = "species",
tests = c("capitals", "centroids",
"equal", "zeros", "countries"))
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
#countries = "countryCode",
species = "species",
tests = c("capitals", "centroids",
"equal", "zeros"))
summary(flags)
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
dat_fl <- dat[!flags$.summary,]
dat_fl
data.frame(dat_fl)
View(dat_fl)
View(df_trametes_sanguinea)
View(df_trametes_sanguinea)
dat_cl <- dat[flags$.summary,]
dat_fl <- dat[!flags$.summary,]
?clean_coordinates
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
#countries = "countryCode",
species = "species",
tests = c("capitals", "centroids", "equal", "gbif", "institutions", "outliers", "seas",
"zeros"))
summary(flags)
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
dat_cl <- dat[flags$.summary,]
dat_fl <- dat[!flags$.summary,]
dat_cl %>%
mutate(Uncertainty = coordinateUncertaintyInMeters / 1000) %>%
ggplot(aes(x = Uncertainty)) +
geom_histogram() +
xlab("Coordinate uncertainty in meters") +
theme_bw()
library(ggplot2)
dat_cl %>%
mutate(Uncertainty = coordinateUncertaintyInMeters / 1000) %>%
ggplot(aes(x = Uncertainty)) +
geom_histogram() +
xlab("Coordinate uncertainty in meters") +
theme_bw()
nrow(dat_cl)
dat_cl <- dat_cl %>%
filter(coordinateUncertaintyInMeters / 1000 <= 100 | is.na(coordinateUncertaintyInMeters))
nrow(dat_cl)
table(dat$basisOfRecord)
dat_cl <- filter(dat_cl, basisOfRecord == "HUMAN_OBSERVATION" |
basisOfRecord == "OBSERVATION" |
basisOfRecord == "PRESERVED_SPECIMEN")
nrow(dat_cl)
table(dat_cl$individualCount)
dat_cl <- dat_cl %>%
filter(individualCount > 0 | is.na(individualCount)) %>%
filter(individualCount < 99 | is.na(individualCount)) # high counts are not a problem
nrow(dat_cl)
table(dat_cl$year)
dat_cl <- dat_cl %>%
filter(year > 1945) # remove records from before second world war
nrow(dat_cl)
table(dat_cl$family)
table(dat_cl$taxonRank)
dat_cl <- dat_cl %>%
filter(family == 'Polyporaceae')
out.ddmm <- cd_ddmm(dat_cl, lon = "decimalLongitude", lat = "decimalLatitude",
ds = "species", diagnostic = T, diff = 1,
value = "dataset")
?clean_dataset
out.ddmm
plot(out.ddmm)
plot(out.ddmm, lon = "decimalLongitude", lat = "decimalLatitude")
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
df_trametes_sanguinea <- read_csv("df_cleana/ocurrences/raw/df_clean_trametes_sanguinea.csv")
df_trametes_sanguinea <- read_csv("df_clean/ocurrences/raw/df_clean_trametes_sanguinea.csv")
df_trametes_sanguinea <- read_csv("df_clean/ocurrences/raw/df_trametes_sanguinea.csv")
df_trametes_sanguinea <- read_csv("data/ocurrences/raw/df_trametes_sanguinea.csv")
nrow(df_trametes_sanguinea)
df_clean <- df_clean.frame(df_clean)
ggplot() +
layer_shp(shp_sf) +
layer_points(df_ocurrences_sf,
crs = st_crs(shp_sf),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
df_clean <- df_clean.frame(df_clean)
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
df_clean <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
summary(flags)
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
df_clean_cl <- df_clean[flags$.summary,]
df_clean_fl <- df_clean[!flags$.summary,]
View(df_clean_fl)
nrow(df)
nrow(df_clean_cl)
df_clean_cl <- df_clean_cl %>%
filter(coordinateUncertaintyInMeters / 1000 <= 10 | is.na(coordinateUncertaintyInMeters))
nrow(df_clean_cl)
table(df_clean_cl$basisOfRecord)
df_clean_cl <- filter(df_clean_cl, basisOfRecord == "HUMAN_OBSERVATION" |
basisOfRecord == "OBSERVATION" |
basisOfRecord == "PRESERVED_SPECIMEN" |
basisOfRecord == "LIVING_SPECIMEN")
nrow(df_clean_cl)
df_clean_cl <- df_clean_cl %>%
filter(individualCount > 0 | is.na(individualCount)) %>%
filter(individualCount < 99 | is.na(individualCount))
nrow(df_clean_cl)
# Remover por fecha
df_clean_cl <- df_clean_cl %>%
filter(year > 1945)
nrow(df_clean_cl)
table(df_clean_cl$basisOfRecord)
View(df_clean_cl)
View(df_clean_cl)
unique(df_clean_cl$speciesKey)
unique(df_clean_cl$taxonKey)
df_clean_cl <- df_clean_cl %>%
filter(scientificName == 'Polyporaceae')
unique(df_clean_cl$taxonKey)
nrow(df_clean_cl)
> table(df_trametes_sanguinea$scientificName)
> table(df_clean$scientificName)
source("../src/utils.R")
source("utils.R")
source("utils.R")
getwd()
