install.packages("CoordinateCleaner")
library(CoordinateCleaner)
install.packages("rgbif")
install.packages("xml2")
install.packages("CoordinateCleaner")
library(CoordinateCleaner)
minages <- runif(250, 0, 65)
exmpl <- data.frame(species = sample(letters, size = 250, replace = TRUE),
decimalLongitude = runif(250, min = 42, max = 51),
decimalLatitude = runif(250, min = -26, max = -11),
min_ma = minages,
max_ma = minages + runif(250, 0.1, 65),
dataset = "clean")
exmlp
exmpl
library(readr)
df_trametes_sanguinea <- read_csv("data/ocurrences/raw/df_trametes_sanguinea.csv")
View(df_trametes_sanguinea)
nrow(df_
trametes)
nrow(df_
trametes_sanguinea)
nrow(df_trametes_sanguinea)
dat <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
install.packages(dplyr)
install.packages("dplyr")
dat <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
library(dplyr)
dat <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
dat
nrow(dat)
dat$countryCode <-  countrycode(dat$countryCode,
origin =  'iso2c',
destination = 'iso3c')
View(dat)
dat <- data.frame(dat)
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
countries = "countryCode",
species = "species",
tests = c("capitals", "centroids",
"equal", "zeros", "countries"))
install.packages("rnaturalearthdata")
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
countries = "countryCode",
species = "species",
tests = c("capitals", "centroids",
"equal", "zeros", "countries"))
flags
summary(flags)
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
#countries = "countryCode",
species = "species",
tests = c("capitals", "centroids",
"equal", "zeros", "countries"))
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
#countries = "countryCode",
species = "species",
tests = c("capitals", "centroids",
"equal", "zeros"))
summary(flags)
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
dat_fl <- dat[!flags$.summary,]
dat_fl
data.frame(dat_fl)
View(dat_fl)
View(df_trametes_sanguinea)
View(df_trametes_sanguinea)
dat_cl <- dat[flags$.summary,]
dat_fl <- dat[!flags$.summary,]
?clean_coordinates
flags <- clean_coordinates(x = dat,
lon = "decimalLongitude",
lat = "decimalLatitude",
#countries = "countryCode",
species = "species",
tests = c("capitals", "centroids", "equal", "gbif", "institutions", "outliers", "seas",
"zeros"))
summary(flags)
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
dat_cl <- dat[flags$.summary,]
dat_fl <- dat[!flags$.summary,]
dat_cl %>%
mutate(Uncertainty = coordinateUncertaintyInMeters / 1000) %>%
ggplot(aes(x = Uncertainty)) +
geom_histogram() +
xlab("Coordinate uncertainty in meters") +
theme_bw()
library(ggplot2)
dat_cl %>%
mutate(Uncertainty = coordinateUncertaintyInMeters / 1000) %>%
ggplot(aes(x = Uncertainty)) +
geom_histogram() +
xlab("Coordinate uncertainty in meters") +
theme_bw()
nrow(dat_cl)
dat_cl <- dat_cl %>%
filter(coordinateUncertaintyInMeters / 1000 <= 100 | is.na(coordinateUncertaintyInMeters))
nrow(dat_cl)
table(dat$basisOfRecord)
dat_cl <- filter(dat_cl, basisOfRecord == "HUMAN_OBSERVATION" |
basisOfRecord == "OBSERVATION" |
basisOfRecord == "PRESERVED_SPECIMEN")
nrow(dat_cl)
table(dat_cl$individualCount)
dat_cl <- dat_cl %>%
filter(individualCount > 0 | is.na(individualCount)) %>%
filter(individualCount < 99 | is.na(individualCount)) # high counts are not a problem
nrow(dat_cl)
table(dat_cl$year)
dat_cl <- dat_cl %>%
filter(year > 1945) # remove records from before second world war
nrow(dat_cl)
table(dat_cl$family)
table(dat_cl$taxonRank)
dat_cl <- dat_cl %>%
filter(family == 'Polyporaceae')
out.ddmm <- cd_ddmm(dat_cl, lon = "decimalLongitude", lat = "decimalLatitude",
ds = "species", diagnostic = T, diff = 1,
value = "dataset")
?clean_dataset
out.ddmm
plot(out.ddmm)
plot(out.ddmm, lon = "decimalLongitude", lat = "decimalLatitude")
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
df_trametes_sanguinea <- read_csv("df_cleana/ocurrences/raw/df_clean_trametes_sanguinea.csv")
df_trametes_sanguinea <- read_csv("df_clean/ocurrences/raw/df_clean_trametes_sanguinea.csv")
df_trametes_sanguinea <- read_csv("df_clean/ocurrences/raw/df_trametes_sanguinea.csv")
df_trametes_sanguinea <- read_csv("data/ocurrences/raw/df_trametes_sanguinea.csv")
nrow(df_trametes_sanguinea)
df_clean <- df_clean.frame(df_clean)
ggplot() +
layer_shp(shp_sf) +
layer_points(df_ocurrences_sf,
crs = st_crs(shp_sf),
x = 'decimalLongitude',
y = 'decimalLatitude',
color = "blue",
size = 1) +
coord_sf() +
theme_minimal()
df_clean <- df_clean.frame(df_clean)
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
df_clean <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
summary(flags)
plot(flags, lon = "decimalLongitude", lat = "decimalLatitude")
df_clean_cl <- df_clean[flags$.summary,]
df_clean_fl <- df_clean[!flags$.summary,]
View(df_clean_fl)
nrow(df)
nrow(df_clean_cl)
df_clean_cl <- df_clean_cl %>%
filter(coordinateUncertaintyInMeters / 1000 <= 10 | is.na(coordinateUncertaintyInMeters))
nrow(df_clean_cl)
table(df_clean_cl$basisOfRecord)
df_clean_cl <- filter(df_clean_cl, basisOfRecord == "HUMAN_OBSERVATION" |
basisOfRecord == "OBSERVATION" |
basisOfRecord == "PRESERVED_SPECIMEN" |
basisOfRecord == "LIVING_SPECIMEN")
nrow(df_clean_cl)
df_clean_cl <- df_clean_cl %>%
filter(individualCount > 0 | is.na(individualCount)) %>%
filter(individualCount < 99 | is.na(individualCount))
nrow(df_clean_cl)
# Remover por fecha
df_clean_cl <- df_clean_cl %>%
filter(year > 1945)
nrow(df_clean_cl)
table(df_clean_cl$basisOfRecord)
View(df_clean_cl)
View(df_clean_cl)
unique(df_clean_cl$speciesKey)
unique(df_clean_cl$taxonKey)
df_clean_cl <- df_clean_cl %>%
filter(scientificName == 'Polyporaceae')
unique(df_clean_cl$taxonKey)
nrow(df_clean_cl)
> table(df_trametes_sanguinea$scientificName)
> table(df_clean$scientificName)
source("../src/utils.R")
source("utils.R")
source("utils.R")
getwd()
source("utils.R")
getwd()
source("src/utils.R")
source("r/src/utils.R")
library(readr)
library(CoordinateCleaner)
library(dplyr)
library(ggplot2)
source("r/src/utils.R")
#<- function
df_trametes_sanguinea <- read_csv("data/ocurrences/raw/df_trametes_sanguinea.csv")
# remover registros sin coordenadas
df_clean <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
# remover registros según los tests
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
summary(flags) # devolver o algo
df_clean_cl <- df_clean[flags$.summary,]
df_clean_fl <- df_clean[!flags$.summary,]
# Remover registros con baja precisión
df_clean_cl <- df_clean_cl %>%
filter(coordinateUncertaintyInMeters / 1000 <= 10 | is.na(coordinateUncertaintyInMeters))
# Remover registros que no correspondan a una observación humana
df_clean_cl <- filter(df_clean_cl, basisOfRecord == "HUMAN_OBSERVATION" |
basisOfRecord == "OBSERVATION" |
basisOfRecord == "PRESERVED_SPECIMEN" |
basisOfRecord == "LIVING_SPECIMEN")
# Remover por fecha
df_clean_cl <- df_clean_cl %>%
filter(year > 1945)
# Remover diferentes especies
df_clean_cl <- df_clean_cl %>%
filter(scientificName == 'Polyporaceae')
nrow(df_clean_cl)
shp_arg_path <- "../../data/shp/argentina/argentina.shp"
shp_arg <- create_shp_from(shp_arg_path)
source("r/src/utils.R")
shp_arg_path <- "../../data/shp/argentina/argentina.shp"
shp_arg <- create_shp_from(shp_arg_path)
shp_arg_path <- "data/shp/argentina/argentina.shp"
shp_arg <- create_shp_from(shp_arg_path)
nrow(df_clean_cl)
df_clean_cl <- filter_points(shp_arg,
df_ocurrences,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
df_clean_cl <- filter_points(shp_arg,
df_clean_cl,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
nrow(df_clean_cl)
shp_arg_path <- "data/shp/sta_fe/sta_fe.shp"
shp_arg <- create_shp_from(shp_arg_path)
shp_arg_path <- "data/shp/santa_fe/santa_fe.shp"
shp_arg <- create_shp_from(shp_arg_path)
df_clean_cl <- filter_points(shp_arg,
df_clean_cl,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
nrow(df_clean_cl)
library(readr)
library(CoordinateCleaner)
library(dplyr)
library(ggplot2)
source("r/src/utils.R")
#<- function
df_trametes_sanguinea <- read_csv("data/ocurrences/raw/df_trametes_sanguinea.csv")
# remover registros sin coordenadas
df_clean <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
# remover registros según los tests
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
summary(flags) # devolver o algo
df_clean_cl <- df_clean[flags$.summary,]
df_clean_fl <- df_clean[!flags$.summary,]
# Remover registros con baja precisión
df_clean_cl <- df_clean_cl %>%
filter(coordinateUncertaintyInMeters / 1000 <= 10 | is.na(coordinateUncertaintyInMeters))
# Remover registros que no correspondan a una observación humana
df_clean_cl <- filter(df_clean_cl, basisOfRecord == "HUMAN_OBSERVATION" |
basisOfRecord == "OBSERVATION" |
basisOfRecord == "PRESERVED_SPECIMEN" |
basisOfRecord == "LIVING_SPECIMEN")
# Remover por fecha
df_clean_cl <- df_clean_cl %>%
filter(year > 1945)
# Remover diferentes especies
df_clean_cl <- df_clean_cl %>%
filter(scientificName == 'Polyporaceae')
#exclude based on study area. fuera de arg
shp_arg_path <- "data/shp/argentina/argentina.shp"
shp_arg <- create_shp_from(shp_arg_path)
df_clean_cl <- filter_points(shp_arg,
df_clean_cl,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
out.ddmm <- cd_ddmm(df_clean_cl, lon = "decimalLongitude", lat = "decimalLatitude",
ds = "species", diagnostic = T, diff = 1,
value = "df_cleanaset")
out.ddmm <- cd_ddmm(df_clean, lon = "decimalLongitude", lat = "decimalLatitude",
ds = "species", diagnostic = T, diff = 1,
value = "df_cleanaset")
View(df_clean_cl)
df_trametes_sanguinea <- read_csv("data/ocurrences/raw/df_trametes_sanguinea.csv")
# remover registros sin coordenadas
df_clean <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
# remover registros según los tests
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
summary(flags) # devolver o algo
df_clean_cl <- df_clean[flags$.summary,]
df_clean_fl <- df_clean[!flags$.summary,]
# Remover registros con baja precisión
df_clean_cl <- df_clean_cl %>%
filter(coordinateUncertaintyInMeters / 1000 <= 10 | is.na(coordinateUncertaintyInMeters))
# Remover registros que no correspondan a una observación humana
df_clean_cl <- filter(df_clean_cl, basisOfRecord == "HUMAN_OBSERVATION" |
basisOfRecord == "OBSERVATION" |
basisOfRecord == "PRESERVED_SPECIMEN" |
basisOfRecord == "LIVING_SPECIMEN")
# Remover por fecha
df_clean_cl <- df_clean_cl %>%
filter(year > 1945)
# Remover diferentes especies
df_clean_cl <- df_clean_cl %>%
filter(scientificName == 'Polyporaceae')
df_arg <- filter_points(shp_arg,
df_clean_cl,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
source("r/src/utils.R")
df_arg <- filter_points(shp_arg,
df_clean_cl,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
View(df_arg)
shp_arg_path <- "data/shp/santa_fe/santa_fe.shp"
shp_arg <- create_shp_from(shp_arg_path)
df_arg <- filter_points(shp_arg,
df_clean_cl,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
View(df_arg)
out.ddmm <- cd_ddmm(df_clean_cl, lon = "decimalLongitude", lat = "decimalLatitude",
ds = "species", diagnostic = T, diff = 1,
value = "df_cleanaset")
View(df_clean_cl)
out.ddmm <- cd_ddmm(df_clean_cl, lon = "decimalLongitude", lat = "decimalLatitude",
ds = "species", diagnostic = T, diff = 1,
value = "dataset")
View(df_clean_cl)
df_clean <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
nrow(df)
nrow(df_clean)
df_clean <- df_clean %>%
filter(year > 1945)
df_clean <- df_clean %>%
filter(year > 1945)
nrow(df_clean)
df_clean <- df_clean %>%
filter(scientificName == 'Polyporaceae')
nrow(df_clean)
shp_arg_path <- "data/shp/argentina/argentina.shp"
shp_arg <- create_shp_from(shp_arg_path)
df_clean <- filter_points(shp_arg,
df_clean,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
nrow(df_clean)
df_clean <- df_clean %>%
filter(coordinateUncertaintyInMeters / 1000 <= 10 | is.na(coordinateUncertaintyInMeters))
nrow(df_clean)
df_clean <- filter(df_clean, basisOfRecord == "HUMAN_OBSERVATION" |
basisOfRecord == "OBSERVATION" |
basisOfRecord == "PRESERVED_SPECIMEN" |
basisOfRecord == "LIVING_SPECIMEN")
nrow(df_clean)
flags <- clean_coordinates(x = df_clean,
lon = "decimalLongitude",
lat = "decimalLatitude",
species = "species",
tests = c("capitals",
"centroids",
"equal",
"gbif",
"institutions",
"outliers",
"seas",
"zeros"))
summary(flags)
df_clean_cl <- df_clean[flags$.summary,]
df_clean_fl <- df_clean[!flags$.summary,]
View(df_clean_fl)
flags
View(flags)
summary(flags)
View(df_clean_fl)
df_clean_fl |>
dplyr::filter(.cap == TRUE)
View(df_clean_fl)
df_clean_fl
View(df_clean_fl)
df_clean_ <- df_clean[flags$.summary,]
df_clean <- df_clean[flags$.summary,]
df_flagged <- df_clean[!flags$.summary,]
df_trametes_sanguinea <- read_csv(df_path)
df_path <- "data/ocurrences/raw/df_trametes_sanguinea.csv"
min_year <- 1945
scientific_name <- 'Polyporaceae'
max_uncertainty_km <- 10
df_trametes_sanguinea <- read_csv(df_path)
# Remover registros sin coordenadas
df_clean <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
# Remover por fecha
df_clean <- df_clean %>%
filter(year >= min_year)
# Remover diferentes especies
df_clean <- df_clean %>%
filter(scientificName == scientific_name)
# Remover registros fuera del área de estudio
shp_area <- create_shp_from(shp_path)
shp_path <- "data/shp/argentina/argentina.shp"
df_trametes_sanguinea <- read_csv(df_path)
# Remover registros sin coordenadas
df_clean <- df_trametes_sanguinea %>%
filter(!is.na(decimalLongitude)) %>%
filter(!is.na(decimalLatitude))
# Remover por fecha
df_clean <- df_clean %>%
filter(year >= min_year)
# Remover diferentes especies
df_clean <- df_clean %>%
filter(scientificName == scientific_name)
# Remover registros fuera del área de estudio
shp_area <- create_shp_from(shp_path)
df_clean <- filter_points(shp_area,
df_clean,
lon_col = 'decimalLongitude',
lat_col = 'decimalLatitude')
View(df_clean)
df_clean |> filter(is.na(coordinateUncertaintyInMeters)) |> nrow()
